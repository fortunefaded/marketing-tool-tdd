# Meta広告API権限ガイド

## 必要な権限

Meta広告APIを使用してインサイトデータを取得するために必要な権限：

### 1. ads_read（必須）

- **説明**: 広告アカウントのデータを読み取る基本的な権限
- **取得できるデータ**:
  - キャンペーン、広告セット、広告の情報
  - インサイトデータ（インプレッション、クリック、コンバージョンなど）
  - 費用データ
  - パフォーマンス指標

### 2. ads_management（必須）

- **説明**: 広告の管理とより詳細なレポートへのアクセス
- **追加で取得できるデータ**:
  - カスタムオーディエンス情報
  - 詳細なターゲティング情報
  - 広告の作成・編集（読み取り専用の場合は不要）

### 3. business_management（必須）

- **説明**: ビジネスマネージャーへのアクセス
- **取得できるデータ**:
  - ビジネスアカウント情報
  - 複数の広告アカウントへのアクセス
  - ピクセルデータ

## 権限の取得方法

1. **Graph API Explorerでの設定**
   - https://developers.facebook.com/tools/explorer/ にアクセス
   - アプリを選択
   - 「Add Permissions」をクリック
   - 以下の権限にチェック：
     - `ads_read`
     - `ads_management`
     - `business_management`
   - 「Generate Access Token」をクリック

2. **アプリレビュー（本番環境の場合）**
   - 開発モードでは自分のアカウントのみアクセス可能
   - 他のユーザーのデータにアクセスする場合はアプリレビューが必要
   - Metaにアプリの使用目的を説明して承認を得る必要がある

## 重要な注意事項

### read_insights権限について

- **`read_insights`権限は2018年に廃止されました**
- 現在は`ads_read`権限でインサイトデータにアクセス可能
- 古いドキュメントでは`read_insights`が記載されている場合がありますが、不要です

### アクセストークンの有効期限

- 短期トークン: 1-2時間
- 長期トークン: 約60日
- システムユーザートークン: 無期限（推奨）

### レート制限

- APIコールには制限があります
- 大量のデータを取得する場合はバッチリクエストを使用
- エラー時は指数バックオフで再試行

## インサイトデータの取得例

```javascript
// ads_read権限のみで取得可能
const insights = await fetch(
  `https://graph.facebook.com/v18.0/act_${accountId}/insights?` +
    `fields=impressions,clicks,spend,conversions,purchase_roas&` +
    `date_preset=last_30d&` +
    `access_token=${accessToken}`
)
```

## トラブルシューティング

### 「権限が不足しています」エラーが出る場合

1. アクセストークンに必要な権限が含まれているか確認
2. Graph API Explorerで「Debug Token」機能を使用して権限を確認
3. トークンの有効期限が切れていないか確認

### データが取得できない場合

1. 広告アカウントIDが正しいか確認（act\_を含める）
2. アカウントへのアクセス権限があるか確認
3. ビジネスマネージャーでユーザーの役割を確認
